<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Daniel Oberbauer">
  <meta name="description" content="Posts and writings by Daniel Oberbauer">


<meta name="keywords" content="">

  <title>
    Daniel Oberbauer
&ndash; Multi Image Steganography  </title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="">
        <img src="/theme/images/logo.png" alt="logo">
      </a>
      <h2><a href="">Daniel Oberbauer</a></h2>
      <p></p>
      <ul>
        <li><a href="/category/art.html">Art</a></li>
        <li><a href="/category/exploration.html">Exploration</a></li>
        <li><a href="/category/project.html">Project</a></li>
        <li><a href="/category/resources.html">Resources</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="">Index</a> &brvbar; <a href="/archives.html">Archives</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="/multi-image-steganography.html">Multi Image Steganography</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 01 January 2024</p>
  </div>
  <div class="article_text">
    <p>I have been wanting to do a steganography project of my own since I picked up my first programming language a few years ago.</p>
<p>Where most steganography projects I've come across aim to secretly embed the entire message in a single image, I wanted to create a method that would encode a message across multiple images. You would need to have the entire collection of images to assemble the complete message.
I also knew I wanted to do direct pixel manipulation rather than modifying metadata or something like that. 
I also wanted to encode as much information as possible using the fewest pixels so the message would be difficult to detect.</p>
<p>Each pixel of a JPG image file has 3 channels: red, green and blue. Each channel can have a value ranging from 0 to 255. 
There are 128 standard unicode characters plus extra non-standard characters as well. </p>
<p>Given that the message spans multiple images, it's important to also include an index denoting the order the information hidden in any particular image fits with information from others. </p>
<p>How many pixels will we need per image?</p>
<ul>
<li>There are three color channels per pixel (RGB)</li>
<li>We need a sort index + n characters encoded as integers </li>
<li>Typical word length is 5 letters </li>
<li>Typical sentence length is 15-20 words. </li>
</ul>
<p>I decided that two pixels would be sufficient. The first pixel would carry the sort index and two characters. The second pixel would carry 3 characters.
If the message length in characters was not divisible by 5 then the remaining characters would be filled with whitespace.</p>
<p>I'm using the first and last pixels in the image, but really any two pixels will do. Choosing pixels away from the edge would prevent loss of encoded message content via cropping.</p>
<p>Unicode characters are converted to integers with <code>ord()</code>. </p>
<p>The decoder converts integers to Unicode characters using <code>chr()</code>.</p>
<h2>The Code</h2>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="n">imagesFolder</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">outDir</span><span class="p">):</span>
   <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
   <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> 
   <span class="kn">import</span> <span class="nn">os</span>
   <span class="kn">import</span> <span class="nn">math</span> 
   <span class="n">imagePaths</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">imagesFolder</span><span class="p">)</span> 
   <span class="n">imgCount</span> <span class="o">=</span><span class="mi">0</span>
   <span class="n">locA</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">),</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
            <span class="n">chunk</span><span class="o">=</span><span class="n">chunk</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">pixA</span> <span class="o">=</span> <span class="p">(</span><span class="n">imgCount</span><span class="p">,</span><span class="nb">ord</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">ord</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">pixB</span> <span class="o">=</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">ord</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="nb">ord</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">imagesFolder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">imagePaths</span><span class="p">[</span><span class="n">imgCount</span><span class="p">])</span>
    <span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
    <span class="n">locB</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">img</span><span class="o">.</span><span class="n">putpixel</span><span class="p">(</span><span class="n">locA</span><span class="p">,</span><span class="n">pixA</span><span class="p">)</span>
    <span class="n">img</span><span class="o">.</span><span class="n">putpixel</span><span class="p">(</span><span class="n">locB</span><span class="p">,</span><span class="n">pixB</span><span class="p">)</span>
    <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">imagesFolder</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">outDir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">imgCount</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
    <span class="n">imgCount</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">imagesFolder</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="n">locA</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">imagePaths</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">imagesFolder</span><span class="p">)</span>
    <span class="n">imgIndices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chunks</span> <span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imagePaths</span><span class="p">)):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">imagesFolder</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">imagePaths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
        <span class="n">locB</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">h</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pixA</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">getpixel</span><span class="p">(</span><span class="n">locA</span><span class="p">)</span>
        <span class="n">pixB</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">getpixel</span><span class="p">(</span><span class="n">locB</span><span class="p">)</span>
        <span class="n">imgIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pixA</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">chunk</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">pixA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">pixA</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">pixB</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">pixB</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="n">pixB</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="n">imgIndices</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imgIndices</span><span class="p">)</span>
    <span class="n">chunks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">imgIndices</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="n">sort</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">message</span>
</code></pre></div>

<h2>Pros</h2>
<ul>
<li>Only modifying two pixels so the file size should stay very similar to the original carrier. </li>
</ul>
<h2>Cons</h2>
<ul>
<li>Cropping the image may remove one or both of the message-carrying pixels.</li>
<li>Compression may alter one or both of the message-carrying pixels.</li>
<li>The pixel's color may be obviously different than pixels around it, tipping off the keen observer to the presence of hidden content.</li>
<li>Long messages would require more images or more message-carrying pixels per image</li>
</ul>
<p><a href="https://github.com/hyperific/steganography-tools/blob/main/multi-image.py">Github link to code</a></p>
  </div>
  <div class="article_meta">
    <p>Category: <a href="/category/exploration.html">Exploration</a>
    </p>
  </div>


</article>


    <div id="ending_message">
      <p>&copy; Daniel Oberbauer. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>