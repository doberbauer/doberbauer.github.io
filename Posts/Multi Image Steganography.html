<p>I have been wanting to do a steganography project of my own since I
picked up my first programming language a few years ago.</p>
<p>Where most steganography projects I’ve come across aim to secretly
embed the entire message in a single image, I wanted to create a method
that would encode a message across multiple images. You would need to
have the entire collection of images to assemble the complete message. I
also knew I wanted to do direct pixel manipulation rather than modifying
metadata or something like that. I also wanted to encode as much
information as possible using the fewest pixels so the message would be
difficult to detect.</p>
<p>Each pixel of a JPG image file has 3 channels: red, green and blue.
Each channel can have a value ranging from 0 to 255. There are 128
standard unicode characters plus extra non-standard characters as
well.</p>
<p>Given that the message spans multiple images, it’s important to also
include an index denoting the order the information hidden in any
particular image fits with information from others.</p>
<p>How many pixels will we need per image?</p>
<ul>
<li>There are three color channels per pixel (RGB)</li>
<li>We need a sort index + n characters encoded as integers</li>
<li>Typical word length is 5 letters</li>
<li>Typical sentence length is 15-20 words.</li>
</ul>
<p>I decided that two pixels would be sufficient. The first pixel would
carry the sort index and two characters. The second pixel would carry 3
characters. If the message length in characters was not divisible by 5
then the remaining characters would be filled with whitespace.</p>
<p>I’m using the first and last pixels in the image, but really any two
pixels will do. Choosing pixels away from the edge would prevent loss of
encoded message content via cropping.</p>
<p>Unicode characters are converted to integers with
<code>ord()</code>.</p>
<p>The decoder converts integers to Unicode characters using
<code>chr()</code>.</p>
<h2 id="the-code">The Code</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode(imagesFolder, message, outDir):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>   <span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   <span class="im">from</span> PIL <span class="im">import</span> Image </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   <span class="im">import</span> os</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>   <span class="im">import</span> math </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   imagePaths <span class="op">=</span> os.listdir(imagesFolder) </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>   imgCount <span class="op">=</span><span class="dv">0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>   locA <span class="op">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">0</span>,<span class="bu">len</span>(message),<span class="dv">5</span>):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">+</span><span class="dv">5</span><span class="op">&gt;</span><span class="bu">len</span>(message):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        chunk <span class="op">=</span> message[i:<span class="bu">len</span>(message)]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> i<span class="op">+</span><span class="dv">5</span><span class="op">-</span><span class="bu">len</span>(message)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> a <span class="kw">in</span> <span class="bu">range</span>(d):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            chunk<span class="op">=</span>chunk <span class="op">+</span> <span class="st">&#39; &#39;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        chunk <span class="op">=</span> message[i:i<span class="op">+</span><span class="dv">5</span>]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    pixA <span class="op">=</span> (imgCount,<span class="bu">ord</span>(chunk[<span class="dv">0</span>]),<span class="bu">ord</span>(chunk[<span class="dv">1</span>]))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    pixB <span class="op">=</span> (<span class="bu">ord</span>(chunk[<span class="dv">2</span>]),<span class="bu">ord</span>(chunk[<span class="dv">3</span>]),<span class="bu">ord</span>(chunk[<span class="dv">4</span>]))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> Image.<span class="bu">open</span>(imagesFolder <span class="op">+</span> <span class="st">&#39;/&#39;</span><span class="op">+</span>imagePaths[imgCount])</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    w,h<span class="op">=</span> img.size</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    locB <span class="op">=</span> (w<span class="op">-</span><span class="dv">1</span>,h<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    img.putpixel(locA,pixA)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    img.putpixel(locB,pixB)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    img.save(imagesFolder <span class="op">+</span><span class="st">&#39;/&#39;</span> <span class="op">+</span> outDir <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> <span class="bu">str</span>(imgCount)<span class="op">+</span><span class="st">&#39;.png&#39;</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    imgCount <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> decode(imagesFolder):</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> os</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    locA<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    imagePaths <span class="op">=</span> os.listdir(imagesFolder)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    imgIndices <span class="op">=</span> []</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    chunks <span class="op">=</span>[]</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(imagePaths)):</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> Image.<span class="bu">open</span>(imagesFolder<span class="op">+</span><span class="st">&#39;/&#39;</span><span class="op">+</span>imagePaths[i])</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        w,h <span class="op">=</span> img.size</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        locB <span class="op">=</span> (w<span class="op">-</span><span class="dv">1</span>,h<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        pixA <span class="op">=</span> img.getpixel(locA)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        pixB <span class="op">=</span> img.getpixel(locB)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        imgIndices.append(pixA[<span class="dv">0</span>])</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        chunk <span class="op">=</span> <span class="bu">chr</span>(pixA[<span class="dv">1</span>])<span class="op">+</span><span class="bu">chr</span>(pixA[<span class="dv">2</span>])<span class="op">+</span><span class="bu">chr</span>(pixB[<span class="dv">0</span>])<span class="op">+</span><span class="bu">chr</span>(pixB[<span class="dv">1</span>])<span class="op">+</span><span class="bu">chr</span>(pixB[<span class="dv">2</span>])</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        chunks.append(chunk)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    imgIndices<span class="op">=</span>np.array(imgIndices)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>np.array(chunks)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    sort <span class="op">=</span> np.argsort(imgIndices)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    message <span class="op">=</span> <span class="st">&quot;&quot;</span>.join(chunks[sort])</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> message</span></code></pre></div>
<h2 id="pros">Pros</h2>
<ul>
<li>Only modifying two pixels so the file size should stay very similar
to the original carrier. ## Cons</li>
<li>Cropping the image may remove one or both of the message-carrying
pixels.</li>
<li>Compression may alter one or both of the message-carrying
pixels.</li>
<li>The pixel’s color may be obviously different than pixels around it,
tipping off the keen observer to the presence of hidden content.</li>
<li>Long messages would require more images or more message-carrying
pixels per image</li>
</ul>
<p><a
href="https://github.com/hyperific/steganography-tools/blob/main/multi-image.py">Github
link to code</a></p>
